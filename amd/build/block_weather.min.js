define ("block_weather/block_weather",["jquery","core/ajax","core/str","core/config","core/notification","core/templates"],function(a,b,c,d,e,f){var g={init:function init(b,d){c.get_strings([{key:"no_geo_location_support",component:"block_weather"},{key:"no_openweather_key",component:"block_weather"},{key:"no_weather_provider",component:"block_weather"}]).done(function(c){if(0===b){g.weatherError(c[2])}else{g.weatherInfo(c,b,d)}a(document).on("click",".block-weather-refresh",function(){var e=a("#weather-container");e.html("");g.weatherInfo(c,b,d)});a(document).on("click",".block-weather-temperature-value",function(){var b=a(".block-weather-temperature-value").attr("data-value");if("-"!==b){var c=a(".block-weather-temperature-value").attr("data-action");if("celsius"===c){var d=Math.floor(9*parseInt(b)/5+32),e=a(".block-weather-temperature-value"),f="<p>"+d+"\xB0<span>F</span></p>";a(".block-weather-temperature-value").attr("data-value",d);a(".block-weather-temperature-value").attr("data-action","fahrenheit");e.html(f)}else{var g=Math.floor(5*(parseInt(b)-32)/9),e=a(".block-weather-temperature-value"),f="<p>"+g+"\xB0<span>C</span></p>";a(".block-weather-temperature-value").attr("data-value",g);a(".block-weather-temperature-value").attr("data-action","celsius");e.html(f)}}})})},weatherInfo:function weatherInfo(a,b,c){if("geolocation"in navigator){navigator.geolocation.getCurrentPosition(d,e)}else{g.weatherError(a[0])}function d(d){var e=d.coords.latitude,f=d.coords.longitude;if(1===b&&c.length){g.openWeather(a,c,e,f)}else{var h=a[1];g.weatherError(h)}}function e(a){var b="".concat(a.message);g.weatherError(b)}},weatherError:function weatherError(b){var c={weathererror:"<p> ".concat(b," </p>"),weathericon:M.util.image_url("unknown","block_weather"),weathervalue:"-",weatherattr:"-"};f.render("block_weather/weather_info",c).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)},openWeather:function openWeather(b,c,d,h){var i="https://api.openweathermap.org/data/2.5/weather?lat=".concat(d,"&lon=").concat(h,"&appid=").concat(c);fetch(i).then(function(a){return a.json()}).then(function(c){if(200===c.cod){var d={weathervalue:Math.floor(c.main.temp-273),weatherdesc:c.weather[0].description,weatherattr:"celsius",weathericon:M.util.image_url(c.weather[0].icon,"block_weather"),weatherlocation:c.name+","+c.sys.country};f.render("block_weather/weather_info",d).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)}else{var h=b[1];g.weatherError(h)}})}};return g});
//# sourceMappingURL=block_weather.min.js.map
