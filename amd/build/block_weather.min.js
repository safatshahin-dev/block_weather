define ("block_weather/block_weather",["jquery","core/ajax","core/str","core/config","core/notification","core/templates"],function(a,b,c,d,e,f){var g={init:function init(b,d){c.get_strings([{key:"no_geo_location_support",component:"block_weather"},{key:"no_openweather_key",component:"block_weather"},{key:"no_weather_provider",component:"block_weather"},{key:"clear_day",component:"block_weather"},{key:"clear_night",component:"block_weather"},{key:"cloudy",component:"block_weather"},{key:"drizzle",component:"block_weather"},{key:"flurries",component:"block_weather"},{key:"fog_light",component:"block_weather"},{key:"fog",component:"block_weather"},{key:"freezing_drizzle",component:"block_weather"},{key:"freezing_rain_heavy",component:"block_weather"},{key:"freezing_rain_light",component:"block_weather"},{key:"freezing_rain",component:"block_weather"},{key:"ice_pellets_heavy",component:"block_weather"},{key:"ice_pellets_light",component:"block_weather"},{key:"ice_pellets",component:"block_weather"},{key:"mostly_clear_day",component:"block_weather"},{key:"mostly_clear_night",component:"block_weather"},{key:"mostly_cloudy",component:"block_weather"},{key:"partly_cloudy_day",component:"block_weather"},{key:"partly_cloudy_night",component:"block_weather"},{key:"rain_heavy",component:"block_weather"},{key:"rain_light",component:"block_weather"},{key:"rain",component:"block_weather"},{key:"snow_heavy",component:"block_weather"},{key:"snow_light",component:"block_weather"},{key:"snow",component:"block_weather"},{key:"tstorm",component:"block_weather"}]).done(function(c){if(0===b){g.weatherError(c[2])}else{g.weatherInfo(c,b,d)}a(document).on("click",".block-weather-refresh",function(){var e=a("#weather-container");e.html("");g.weatherInfo(c,b,d)});a(document).on("click",".block-weather-temperature-value",function(){var b=a(".block-weather-temperature-value").attr("data-value");if("-"!==b){var c=a(".block-weather-temperature-value").attr("data-action");if("celsius"===c){var d=Math.floor(9*parseInt(b)/5+32),e=a(".block-weather-temperature-value"),f="<p>"+d+"\xB0<span>F</span></p>";a(".block-weather-temperature-value").attr("data-action","fahrenheit");e.html(f)}else{var e=a(".block-weather-temperature-value"),f="<p>"+b+"\xB0<span>C</span></p>";a(".block-weather-temperature-value").attr("data-action","celsius");e.html(f)}}})})},weatherInfo:function weatherInfo(a,b,c){if("geolocation"in navigator){navigator.geolocation.getCurrentPosition(d,e)}else{g.weatherError(a[0])}function d(d){var e=d.coords.latitude,f=d.coords.longitude,h=d.timestamp;if(1===b&&c.length){g.openWeather(a,c,e,f)}else if(2===b&&c.length){g.accuWeather(a,c,e,f)}else if(3===b&&c.length){g.climacellWeather(a,c,e,f,h)}else{var i=a[1];g.weatherError(i)}}function e(a){var b="".concat(a.message);g.weatherError(b)}},weatherError:function weatherError(b){var c={weathererror:"<p> ".concat(b," </p>"),weathericon:M.util.image_url("unknown","block_weather"),weathervalue:"-",weatherattr:"-"};f.render("block_weather/weather_info",c).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)},openWeather:function openWeather(b,c,d,h){var i="https://api.openweathermap.org/data/2.5/weather?lat=".concat(d,"&lon=").concat(h,"&appid=").concat(c);fetch(i).then(function(a){return a.json()}).then(function(c){if(200===c.cod){var d={weathervalue:Math.floor(c.main.temp-273),weatherdesc:c.weather[0].description,weatherattr:"celsius",weathericon:M.util.image_url(c.weather[0].icon,"block_weather"),weatherlocation:c.name+", "+c.sys.country};f.render("block_weather/weather_info",d).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)}else{var h=b[1];g.weatherError(h)}})},accuWeather:function accuWeather(b,c,d,h){var i="https://dataservice.accuweather.com/locations/v1/cities/geoposition/search?apikey=".concat(c,"&q=").concat(d,"%2C").concat(h,"&language=en-us&details=false&toplevel=false");fetch(i).then(function(a){return a.json()}).then(function(d){if(d.Key.length){var i="https://dataservice.accuweather.com/currentconditions/v1/".concat(d.Key,"?apikey=").concat(c,"&language=en-us&details=false");fetch(i).then(function(a){return a.json()}).then(function(c){if(c[0].WeatherText.length){var h={weathervalue:Math.floor(c[0].Temperature.Metric.Value),weatherdesc:c[0].WeatherText,weatherattr:"celsius",weathericon:M.util.image_url(c[0].WeatherIcon,"block_weather"),weatherlocation:d.EnglishName+", "+d.AdministrativeArea.EnglishName};f.render("block_weather/weather_info",h).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)}else{var i=b[1];g.weatherError(i)}})}else{var h=b[1];g.weatherError(h)}})},climacellWeather:function climacellWeather(b,c,d,h,i){var j="https://api.climacell.co/v3/weather/realtime?lat=".concat(d,"&lon=").concat(h,"&unit_system=si&fields=temp%2Cweather_code&apikey=").concat(c);fetch(j).then(function(a){return a.json()}).then(function(c){if(c.message){var j=b[1];g.weatherError(j)}else{var k=c.weather_code.value;if("clear"===c.weather_code.value){var l=new Date(i),m=l.getHours();if(18<=m||6>=m){k=c.weather_code.value+"_night"}else{k=c.weather_code.value+"_day"}}var n="https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(d,"&longitude=").concat(h,"&localityLanguage=en");fetch(n).then(function(a){return a.json()}).then(function(b){var d="";if(b.locality){d=b.locality+", "+b.principalSubdivision}var g={weathervalue:Math.floor(c.temp.value),weatherdesc:M.util.get_string(k,"block_weather","string"),weatherattr:"celsius",weathericon:M.util.image_url(k,"block_weather"),weatherlocation:d};f.render("block_weather/weather_info",g).then(function(b){var c=a("#weather-container");c.html(b)}).fail(e.exception)})}})}};return g});
//# sourceMappingURL=block_weather.min.js.map
