{"version":3,"sources":["../src/block_weather.js"],"names":["define","$","AJAX","str","mdlcfg","notification","templates","weather","init","enabledOption","openWeatherKey","get_strings","component","done","s","weatherInfo","document","on","tag","html","tempValue","attr","tempAction","farhValue","Math","floor","parseInt","temp","tempData","celcValue","navigator","geolocation","getCurrentPosition","setPosition","showError","weatherError","position","latitude","coords","longitude","length","openWeather","errorMsg","error","message","context","weathererror","weathericon","M","util","image_url","weathervalue","weatherattr","render","then","fail","exception","api","fetch","response","json","data","cod","main","weatherdesc","description","icon","weatherlocation","name","sys","country"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/str', 'core/config', 'core/notification', 'core/templates'],\n    function($, AJAX, str, mdlcfg, notification, templates) {\n        var weather = {\n            init: function(enabledOption, openWeatherKey) {\n                str.get_strings([\n                    {'key': 'no_geo_location_support', component: 'block_weather'},\n                    {'key': 'no_openweather_key', component: 'block_weather'}\n                ]).done(function(s) {\n                    weather.weatherInfo(s, enabledOption, openWeatherKey);\n                    $(document).on('click', '.block-weather-refresh', function() {\n                        var tag = $('#weather-container');\n                        var html = '';\n                        tag.html(html);\n                        weather.weatherInfo(s, enabledOption, openWeatherKey);\n                    });\n                    $(document).on('click', '.block-weather-temperature-value', function() {\n                        var tempValue = $('.block-weather-temperature-value').attr('data-value');\n                        if (tempValue !== '-') {\n                            var tempAction = $('.block-weather-temperature-value').attr('data-action');\n                            if (tempAction === 'celsius') {\n                                var farhValue = Math.floor((parseInt(tempValue) * 9 / 5) + 32);\n                                var temp = $('.block-weather-temperature-value');\n                                var tempData = '<p>' + farhValue + '°<span>F</span></p>';\n                                $('.block-weather-temperature-value').attr('data-value', farhValue);\n                                $('.block-weather-temperature-value').attr('data-action', 'fahrenheit');\n                                temp.html(tempData);\n                            } else {\n                                var celcValue = Math.floor((parseInt(tempValue) - 32) * 5 / 9);\n                                var temp = $('.block-weather-temperature-value');\n                                var tempData = '<p>' + celcValue + '°<span>C</span></p>';\n                                $('.block-weather-temperature-value').attr('data-value', celcValue);\n                                $('.block-weather-temperature-value').attr('data-action', 'celsius');\n                                temp.html(tempData);\n                            }\n                        }\n                    });\n                });\n            },\n            weatherInfo: function(s, enabledOption, openWeatherKey) {\n                // CHECK IF BROWSER SUPPORTS GEOLOCATION\n                if ('geolocation' in navigator) {\n                    navigator.geolocation.getCurrentPosition(setPosition, showError);\n                } else {\n                    weather.weatherError(s[0]);\n                }\n\n                // SET USER'S POSITION\n                function setPosition(position) {\n                    let latitude = position.coords.latitude;\n                    let longitude = position.coords.longitude;\n                    if (enabledOption === 1 && openWeatherKey.length) {\n                        weather.openWeather(s, openWeatherKey, latitude, longitude);\n                    } else {\n                        var errorMsg = s[1];\n                        weather.weatherError(errorMsg);\n                    }\n                }\n\n                // SHOW ERROR WHEN THERE IS AN ISSUE WITH GEOLOCATION SERVICE\n                function showError(error) {\n                    var errorMsg = `${error.message}`;\n                    weather.weatherError(errorMsg);\n                }\n            },\n            weatherError: function(error) {\n                var context = {\n                    weathererror: `<p> ${error} </p>`,\n                    weathericon: M.util.image_url('unknown', 'block_weather'),\n                    weathervalue: '-',\n                    weatherattr: '-'\n                };\n                templates.render('block_weather/weather_info', context).then(function(html, js) {\n                    var tag = $('#weather-container');\n                    tag.html(html);\n                }).fail(notification.exception);\n            },\n            openWeather: function(s, openWeatherKey, latitude, longitude) {\n                let api = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${openWeatherKey}`;\n                fetch(api)\n                    .then(function(response){\n                        return response.json();\n                    })\n                    .then(function(data) {\n                        if (data.cod === 200) {\n                            var context = {\n                                weathervalue: Math.floor(data.main.temp - 273),\n                                weatherdesc: data.weather[0].description,\n                                weatherattr: 'celsius',\n                                weathericon: M.util.image_url(data.weather[0].icon, 'block_weather'),\n                                weatherlocation: data.name + ',' + data.sys.country\n                            };\n                            templates.render('block_weather/weather_info', context).then(function(html, js) {\n                                var tag = $('#weather-container');\n                                tag.html(html);\n                            }).fail(notification.exception);\n                        } else {\n                            var errorMsg = s[1];\n                            weather.weatherError(errorMsg);\n                        }\n                    });\n            }\n        };\n        return weather;\n    });\n"],"file":"block_weather.min.js"}